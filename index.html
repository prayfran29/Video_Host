<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Majin Video Streams - Discover</title>
    <link rel="icon" type="image/x-icon" href="/public/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Majin Streams">
    <link rel="apple-touch-icon" href="/public/icon.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=22">

</head>
<body>
    <header class="header">
        <div class="container">
            <div class="nav-brand">
                <h1>Majin Video Streams</h1>
            </div>

            <div class="nav-actions">
                <button class="exit-btn" onclick="Android.exitApp()" title="Exit App" style="display:none" id="exitBtn" tabindex="0">‚ùå</button>
                <button class="reload-btn" onclick="window.location.reload(true)" title="Reload Page" style="display:none" id="reloadBtn" tabindex="0">üîÑ</button>
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search videos..." class="search-input" oninput="showSearchResults()" autocomplete="off" readonly>
                    <button class="search-btn" onclick="activateSearch()">üîç</button>
                    <div id="searchResults" class="search-results"></div>
                </div>
                <button class="profile-btn" onclick="toggleAuth()" id="profileButton">üë§ Login</button>
                <button class="profile-btn" onclick="goToAdmin()" id="adminButton" style="display:none">‚öôÔ∏è Admin</button>
            </div>
        </div>
    </header>

    <main>
        <section class="content-sections" style="margin-top: 80px;">
            <div class="container">
                <div class="section">
                    <h3>Continue Watching</h3>
                    <div class="continue-watching-swimlane" id="continueWatchingGrid">
                        <!-- Continue watching items will be populated here -->
                    </div>
                </div>

                <div id="genreSections">
                    <!-- Genre swimlanes will be populated here -->
                </div>
                
                <div class="section">
                    <h3>All Series</h3>
                    <div class="content-grid" id="allSeriesGrid">
                        <!-- All videos will be populated here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuth()">&times;</span>
            <div id="loginForm">
                <h3>Login</h3>
                <input type="text" id="loginUsername" placeholder="Username" tabindex="0">
                <input type="password" id="loginPassword" placeholder="Password" tabindex="0" onfocus="this.value=''">
                <button onclick="login()">Login</button>
                <button onclick="showQRLogin()" style="background:#333;margin-top:0.5rem;">üì± Login with QR Code</button>
                <p>Don't have an account? <button type="button" onclick="showRegister()" style="background:none;border:none;color:#0066ff;text-decoration:underline;cursor:pointer;">Register</button></p>
            </div>
            <div id="qrLoginForm" style="display:none;" class="qr-modal">
                <h3>QR Code Login</h3>
                <div id="qrContainer" style="text-align:center;padding:2rem;">
                    <div id="qrCode"></div>
                    <p style="margin-top:1rem;color:#999;">Scan with your phone to login</p>
                    <div id="qrStatus" style="margin-top:1rem;color:#0066ff;">Generating QR code...</div>
                </div>
                <button onclick="showLogin()" style="background:#333;">‚Üê Back to Login</button>
            </div>
            <div id="registerForm" style="display:none">
                <h3>Register</h3>
                <input type="text" id="registerUsername" placeholder="Username (3-30 chars, letters/numbers/_)" tabindex="0">
                <input type="password" id="registerPassword" placeholder="Password (8+ chars, A-z, 0-9, @$!%*?&)" tabindex="0">
                <button onclick="register()">Register</button>
                <p>Already have an account? <button type="button" onclick="showLogin()" style="background:none;border:none;color:#0066ff;text-decoration:underline;cursor:pointer;">Login</button></p>
                <div class="password-requirements">
                    <small>Password must contain:</small>
                    <ul>
                        <li>At least 8 characters</li>
                        <li>Uppercase letter (A-Z)</li>
                        <li>Lowercase letter (a-z)</li>
                        <li>Number (0-9)</li>
                        <li>Special character (@$!%*?&)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Series Modal -->
    <div id="seriesModal" class="modal">
        <div class="modal-content series-modal">
            <h3 id="seriesTitle"></h3>
            <div id="videoList" class="video-list">
                <!-- Video episodes will be populated here -->
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="videoModal" class="modal">
        <div class="modal-content video-modal">
            <span class="close" onclick="closeVideo()">&times;</span>
            <div class="video-container">
                <video id="videoPlayer" controls preload="metadata" autoplay>
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div id="videoLoading" class="video-loading" style="display:none;">
                    <div class="loading-spinner"></div>
                    <p>Loading video...</p>
                </div>
            </div>
            <div class="audio-controls">
                <label>Audio Track:</label>
                <select id="audioTrackSelect" onchange="switchAudioTrack()"></select>
            </div>
            <div class="video-info">
                <div class="title-row">
                    <button onclick="backToSeries()" tabindex="0" class="episodes-btn" title="Episodes">‚ò∞</button>
                    <h3 id="videoTitle"></h3>
                </div>

            </div>
            <div id="videoDescription" class="video-description" style="margin-top: 1rem; color: #ccc; font-size: 0.9rem; line-height: 1.4;"></div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; <span id="currentYear"></span> Majin Video Streams. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js?t=1735687300"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('SW registered'))
                .catch(() => console.log('SW registration failed'));
        }
    </script>
</body>
</html>